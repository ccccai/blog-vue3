{"id":32,"title":"配置 Supervisor，linux下的队列进程管理服务端","subTitle":"supervisord 是进程管理的服务端，常驻进程辅助干活; supervisorctl 是客户端，用来执行查看、加载等命令","link":null,"description":"","content":"### 一、Supervisor 安装\n``` bash\npip install supervisor\n```\n或者是\n``` bash\nyum install supervisor  # centos\nsudo apt-get install supervisor  # ubuntu\n```\n\n### 二、Supervisor 配置\n#### 创建文件夹\n``` bash\nmkdir -p /etc/supervisor/\nmkdir -p /etc/supervisor/supervisord.d/\n```\n\n#### 生成配置文件\n``` bash\necho_supervisord_conf > /etc/supervisor/supervisord.conf\n```\n\n#### 编辑配置文件\n``` bash\nvim /etc/supervisor/supervisord.conf\n```\n配置文件中配置除了最后两行，使用默认的就行。vim中使用G把光标跳到文件末尾，将最后一行修改为如下。\n```\n[include]\nfiles = /etc/supervisor/supervisord.d/*.conf\n```\n\n#### 创建启动脚本\n```bash\nvim /etc/supervisor/supervisord.d/shopApi.conf\n```\n\n#### 启动脚本内容 注意修改项目artisan文件路径\n``` bash\n[program:xmshop-api]\nprocess_name=%(program_name)s_%(process_num)02d\ncommand=php /mnt/www/xmshopApi/artisan queue:work --tries 3 --sleep 3\nautostart=true\nautorestart=true\nuser=root\nnumprocs=1\nredirect_stderr=true\nstdout_logfile=/mnt/www/shopApi/storage/logs/supervisor.log\n```\n\n### 三、启动 supervisor\n``` bash\n#启动supervisord服务\nsupervisord -c /etc/supervisor/supervisord.conf\n\nsupervisorctl reload  # 重启 supervisord\nsupervisorctl reread  # 重新读取配置文件 supervisord\nsupervisorctl start lumen_worker:*  # 启动lumen_worker服务\n\nsupervisorctl restart lumen_worker:*  # 重启lumen_worker服务\n```\n\n启动后查看一下运行状态\n``` bash\nsupervisorctl status\n```\n\n![运行状态](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/15/16c9470e1e76086d~tplv-t2oaga2asx-image.image)\n\n```!\n修改了文件之后一定要重启才有用，reread没有用\n```","tagIds":"27,29,32","author":"菜头","authorAvatar":"http://3.bp.blogspot.com/-powJHBZ_dI0/Uuax5aG2dQI/AAAAAAAAHjY/BrKvCsBzaCU/s1600/minions-gifs-animados-imagens-que-se-mexem.gif","weight":5,"type":1,"groupTimestamp":"1534887126376","cover":"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/8/15/16c94903ef214c68~tplv-t2oaga2asx-jj:216:144:0:0:q75.avis","categoryId":2,"created_at":"2023-11-22T21:33:08.000Z","updated_at":"2023-11-22T21:49:55.000Z","tagList":[{"id":27,"name":"Linux"},{"id":29,"name":"PhpStudy"},{"id":32,"name":"Laravel"}],"createDate":"2018-08-22"}